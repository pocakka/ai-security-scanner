/**
 * JavaScript Library CVE Database
 *
 * Offline CVE (Common Vulnerabilities and Exposures) database for popular JavaScript libraries.
 * This allows the scanner to identify known security vulnerabilities based on library version numbers
 * WITHOUT requiring external API calls or internet connectivity.
 *
 * Data sources:
 * - Snyk Vulnerability Database (https://snyk.io/vuln)
 * - National Vulnerability Database (https://nvd.nist.gov/)
 * - GitHub Security Advisories
 * - npm security advisories
 *
 * Last updated: 2025-01
 */

export interface CVE {
  id: string // CVE-2023-12345 or SNYK-JS-LIBRARY-12345
  severity: 'low' | 'medium' | 'high' | 'critical'
  title: string
  description: string
  affectedVersions: string // e.g., "<3.5.0", ">=1.0.0 <2.3.4", "1.2.3"
  fixedIn?: string // Version that fixes the vulnerability
  cweId?: string // CWE-79 (XSS), CWE-89 (SQL Injection), etc.
  cvssScore?: number // 0.0-10.0
  published?: string // ISO date
  references: string[] // URLs to advisories, patches
}

export interface LibraryCVE {
  libraryName: string
  cves: CVE[]
}

/**
 * Offline CVE Database
 *
 * Note: This is a curated subset of the most critical CVEs.
 * For comprehensive vulnerability detection, integrate with Snyk API or similar service.
 */
export const CVE_DATABASE: LibraryCVE[] = [
  // jQuery - Most popular JavaScript library
  {
    libraryName: 'jquery',
    cves: [
      {
        id: 'CVE-2020-11022',
        severity: 'medium',
        title: 'Cross-Site Scripting (XSS) in jQuery.htmlPrefilter',
        description: 'Passing HTML from untrusted sources - even after sanitizing it - to one of jQuery\'s DOM manipulation methods (i.e. .html(), .append(), and others) may execute untrusted code.',
        affectedVersions: '>=1.2.0 <3.5.0',
        fixedIn: '3.5.0',
        cweId: 'CWE-79',
        cvssScore: 6.1,
        published: '2020-04-23',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2020-11022',
          'https://blog.jquery.com/2020/04/10/jquery-3-5-0-released/',
          'https://github.com/jquery/jquery/security/advisories/GHSA-gxr4-xjj5-5px2'
        ]
      },
      {
        id: 'CVE-2020-11023',
        severity: 'medium',
        title: 'Cross-Site Scripting (XSS) in jQuery DOM manipulation',
        description: 'Untrusted code execution when passing HTML to jQuery manipulation methods. Affects .html(), .append(), .prepend(), .after(), .before(), .replaceWith(), .wrap(), .wrapAll(), .wrapInner().',
        affectedVersions: '>=1.0.3 <3.5.0',
        fixedIn: '3.5.0',
        cweId: 'CWE-79',
        cvssScore: 6.1,
        published: '2020-04-29',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2020-11023',
          'https://github.com/jquery/jquery/security/advisories/GHSA-jpcq-cgw6-v4j6'
        ]
      },
      {
        id: 'CVE-2019-11358',
        severity: 'medium',
        title: 'Prototype Pollution in jQuery.extend()',
        description: 'jQuery.extend(true, {}, ...) is vulnerable to prototype pollution attack which can modify Object.prototype, potentially leading to denial of service or arbitrary code execution.',
        affectedVersions: '<3.4.0',
        fixedIn: '3.4.0',
        cweId: 'CWE-1321',
        cvssScore: 6.1,
        published: '2019-04-19',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2019-11358',
          'https://blog.jquery.com/2019/04/10/jquery-3-4-0-released/',
          'https://snyk.io/vuln/SNYK-JS-JQUERY-174006'
        ]
      },
      {
        id: 'CVE-2015-9251',
        severity: 'medium',
        title: 'Cross-Site Scripting (XSS) in jQuery.ajax()',
        description: 'jQuery before 3.0.0 allows Cross-site Scripting attacks via the load method. The load method fails to recognize and remove "<script>" HTML tags that contain a whitespace character.',
        affectedVersions: '<3.0.0',
        fixedIn: '3.0.0',
        cweId: 'CWE-79',
        cvssScore: 6.1,
        published: '2018-01-18',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2015-9251',
          'https://github.com/jquery/jquery/issues/2432'
        ]
      }
    ]
  },

  // Lodash - Utility library
  {
    libraryName: 'lodash',
    cves: [
      {
        id: 'CVE-2021-23337',
        severity: 'high',
        title: 'Command Injection in lodash template',
        description: 'Lodash template function can execute arbitrary JavaScript code if attacker controls the template string. This can lead to Remote Code Execution (RCE) in server-side applications.',
        affectedVersions: '<4.17.21',
        fixedIn: '4.17.21',
        cweId: 'CWE-94',
        cvssScore: 7.2,
        published: '2021-02-15',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2021-23337',
          'https://snyk.io/vuln/SNYK-JS-LODASH-1040724',
          'https://github.com/lodash/lodash/commit/c4847ebe7d14540bb28a8b932a9ce1b9ecbfee1a'
        ]
      },
      {
        id: 'CVE-2020-28500',
        severity: 'medium',
        title: 'Regular Expression Denial of Service (ReDoS) in lodash',
        description: 'Lodash toNumber, trim and trimEnd functions are vulnerable to ReDoS attack through extremely long strings, causing the application to hang.',
        affectedVersions: '<4.17.21',
        fixedIn: '4.17.21',
        cweId: 'CWE-400',
        cvssScore: 5.3,
        published: '2021-02-15',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2020-28500',
          'https://github.com/lodash/lodash/pull/5065'
        ]
      },
      {
        id: 'CVE-2019-10744',
        severity: 'critical',
        title: 'Prototype Pollution in lodash',
        description: 'Lodash defaultsDeep function allows attackers to modify Object.prototype, potentially leading to denial of service or remote code execution through prototype pollution.',
        affectedVersions: '<4.17.12',
        fixedIn: '4.17.12',
        cweId: 'CWE-1321',
        cvssScore: 9.1,
        published: '2019-07-26',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2019-10744',
          'https://snyk.io/vuln/SNYK-JS-LODASH-450202',
          'https://github.com/lodash/lodash/pull/4336'
        ]
      },
      {
        id: 'CVE-2018-16487',
        severity: 'high',
        title: 'Prototype Pollution in lodash merge/mergeWith',
        description: 'Prototype pollution vulnerability in merge, mergeWith, and defaultsDeep functions could allow attackers to modify behavior of all objects.',
        affectedVersions: '<4.17.11',
        fixedIn: '4.17.11',
        cweId: 'CWE-1321',
        cvssScore: 7.4,
        published: '2019-02-01',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2018-16487',
          'https://hackerone.com/reports/380873'
        ]
      }
    ]
  },

  // Moment.js - Date/time library (deprecated but still widely used)
  {
    libraryName: 'moment',
    cves: [
      {
        id: 'CVE-2022-31129',
        severity: 'high',
        title: 'Regular Expression Denial of Service (ReDoS) in moment',
        description: 'moment().format() is vulnerable to ReDoS when parsing user-provided format strings. Extremely long or specially crafted format strings can cause the application to hang.',
        affectedVersions: '<2.29.4',
        fixedIn: '2.29.4',
        cweId: 'CWE-1333',
        cvssScore: 7.5,
        published: '2022-07-06',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2022-31129',
          'https://github.com/moment/moment/security/advisories/GHSA-wc69-rhjr-hc9g',
          'https://github.com/moment/moment/commit/9a3b5894f3d5d602948ac8a02e4ee528a49ca3a3'
        ]
      },
      {
        id: 'CVE-2022-24785',
        severity: 'high',
        title: 'Path Traversal in moment-timezone',
        description: 'moment-timezone package is vulnerable to path traversal allowing attackers to read arbitrary files from the server when loading timezone data.',
        affectedVersions: '<0.5.35',
        fixedIn: '0.5.35',
        cweId: 'CWE-22',
        cvssScore: 7.5,
        published: '2022-04-04',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2022-24785',
          'https://github.com/moment/moment-timezone/security/advisories/GHSA-56x4-j7p9-fcf9'
        ]
      }
    ]
  },

  // Axios - HTTP client
  {
    libraryName: 'axios',
    cves: [
      {
        id: 'CVE-2023-45857',
        severity: 'medium',
        title: 'Server-Side Request Forgery (SSRF) in axios',
        description: 'Axios follows HTTP redirects by default without validating the redirect URL. This can be exploited for SSRF attacks to access internal services or metadata endpoints.',
        affectedVersions: '>=0.8.1 <1.6.0',
        fixedIn: '1.6.0',
        cweId: 'CWE-918',
        cvssScore: 6.5,
        published: '2023-11-08',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2023-45857',
          'https://github.com/axios/axios/security/advisories/GHSA-wf5p-g6vw-rhxx',
          'https://github.com/axios/axios/releases/tag/v1.6.0'
        ]
      },
      {
        id: 'CVE-2021-3749',
        severity: 'high',
        title: 'Regular Expression Denial of Service (ReDoS) in axios',
        description: 'axios.utils.trim() is vulnerable to ReDoS attack through extremely long whitespace strings, causing the application to hang.',
        affectedVersions: '<0.21.3',
        fixedIn: '0.21.3',
        cweId: 'CWE-1333',
        cvssScore: 7.5,
        published: '2021-08-31',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2021-3749',
          'https://github.com/axios/axios/commit/5b457116e31db0e88fede6c428e969e87f290929'
        ]
      }
    ]
  },

  // Angular (including AngularJS)
  {
    libraryName: 'angular',
    cves: [
      {
        id: 'CVE-2023-26116',
        severity: 'high',
        title: 'Cross-Site Scripting (XSS) in Angular expressions',
        description: 'Angular expressions in versions before patching are vulnerable to XSS when using user-controlled input in templates without proper sanitization.',
        affectedVersions: '>=1.3.0 <1.8.3',
        fixedIn: '1.8.3',
        cweId: 'CWE-79',
        cvssScore: 7.4,
        published: '2023-02-27',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2023-26116',
          'https://github.com/angular/angular.js/security/advisories/GHSA-2qqx-w9hr-q5gx'
        ]
      },
      {
        id: 'CVE-2020-7676',
        severity: 'medium',
        title: 'Prototype Pollution in AngularJS',
        description: 'AngularJS $sanitize service is vulnerable to prototype pollution through crafted HTML input.',
        affectedVersions: '<1.8.0',
        fixedIn: '1.8.0',
        cweId: 'CWE-1321',
        cvssScore: 5.6,
        published: '2020-06-08',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2020-7676',
          'https://snyk.io/vuln/SNYK-JS-ANGULAR-570058'
        ]
      }
    ]
  },

  // Bootstrap - Frontend framework
  {
    libraryName: 'bootstrap',
    cves: [
      {
        id: 'CVE-2019-8331',
        severity: 'medium',
        title: 'Cross-Site Scripting (XSS) in Bootstrap tooltip/popover',
        description: 'Bootstrap before 4.3.1 allows XSS in the tooltip or popover data-template attribute when user-controlled HTML is injected.',
        affectedVersions: '>=4.0.0 <4.3.1',
        fixedIn: '4.3.1',
        cweId: 'CWE-79',
        cvssScore: 6.1,
        published: '2019-02-20',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2019-8331',
          'https://github.com/twbs/bootstrap/issues/28236',
          'https://blog.getbootstrap.com/2019/02/13/bootstrap-4-3-1-and-3-4-1/'
        ]
      },
      {
        id: 'CVE-2018-14041',
        severity: 'medium',
        title: 'Cross-Site Scripting (XSS) in Bootstrap collapse',
        description: 'Bootstrap before 4.1.2 allows XSS in the collapse data-parent attribute.',
        affectedVersions: '>=4.0.0 <4.1.2',
        fixedIn: '4.1.2',
        cweId: 'CWE-79',
        cvssScore: 6.1,
        published: '2018-07-13',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2018-14041',
          'https://github.com/twbs/bootstrap/issues/26625'
        ]
      }
    ]
  },

  // React (react-dom)
  {
    libraryName: 'react-dom',
    cves: [
      {
        id: 'CVE-2018-6341',
        severity: 'medium',
        title: 'Cross-Site Scripting (XSS) in React SSR',
        description: 'React SSR (Server-Side Rendering) is vulnerable to XSS when rendering user-controlled content without proper escaping in certain edge cases.',
        affectedVersions: '<16.4.2',
        fixedIn: '16.4.2',
        cweId: 'CWE-79',
        cvssScore: 6.1,
        published: '2018-08-17',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2018-6341',
          'https://reactjs.org/blog/2018/08/01/react-v-16-4-2.html'
        ]
      }
    ]
  },

  // Vue.js
  {
    libraryName: 'vue',
    cves: [
      {
        id: 'CVE-2024-9506',
        severity: 'medium',
        title: 'Cross-Site Scripting (XSS) in Vue v-html directive',
        description: 'Vue.js v-html directive can execute malicious scripts if user-controlled HTML is rendered without sanitization.',
        affectedVersions: '<2.7.16',
        fixedIn: '2.7.16',
        cweId: 'CWE-79',
        cvssScore: 6.1,
        published: '2024-10-08',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2024-9506',
          'https://github.com/vuejs/vue/security/advisories/GHSA-6xx6-prvw-8qh6'
        ]
      }
    ]
  },

  // Underscore.js - Utility library (similar to Lodash)
  {
    libraryName: 'underscore',
    cves: [
      {
        id: 'CVE-2021-23358',
        severity: 'high',
        title: 'Arbitrary Code Execution in underscore template',
        description: 'Underscore template function can execute arbitrary JavaScript code when processing attacker-controlled templates.',
        affectedVersions: '<1.13.0-0',
        fixedIn: '1.13.0-0',
        cweId: 'CWE-94',
        cvssScore: 7.2,
        published: '2021-03-29',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2021-23358',
          'https://snyk.io/vuln/SNYK-JS-UNDERSCORE-1080984',
          'https://github.com/jashkenas/underscore/commit/4c73526d43838ad6ab43a6134728776632adeb66'
        ]
      }
    ]
  },

  // Handlebars - Template engine
  {
    libraryName: 'handlebars',
    cves: [
      {
        id: 'CVE-2021-23383',
        severity: 'critical',
        title: 'Remote Code Execution in Handlebars',
        description: 'Handlebars before 4.7.7 allows prototype pollution and remote code execution through template compilation with attacker-controlled input.',
        affectedVersions: '<4.7.7',
        fixedIn: '4.7.7',
        cweId: 'CWE-94',
        cvssScore: 9.8,
        published: '2021-04-12',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2021-23383',
          'https://github.com/handlebars-lang/handlebars.js/security/advisories/GHSA-f2jv-r9rf-7988',
          'https://github.com/handlebars-lang/handlebars.js/commit/f0589701698268578199be25285b2d1f1e427af9'
        ]
      },
      {
        id: 'CVE-2019-19919',
        severity: 'critical',
        title: 'Prototype Pollution in Handlebars',
        description: 'Prototype pollution vulnerability in Handlebars lookup helper allows arbitrary code execution.',
        affectedVersions: '<4.5.3',
        fixedIn: '4.5.3',
        cweId: 'CWE-1321',
        cvssScore: 9.8,
        published: '2019-12-20',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2019-19919',
          'https://github.com/handlebars-lang/handlebars.js/commit/cd38583216dce3252831916323202749431c773e'
        ]
      }
    ]
  },

  // Marked - Markdown parser
  {
    libraryName: 'marked',
    cves: [
      {
        id: 'CVE-2022-21681',
        severity: 'high',
        title: 'Regular Expression Denial of Service (ReDoS) in marked',
        description: 'marked markdown parser is vulnerable to ReDoS attack through specially crafted markdown input causing catastrophic backtracking.',
        affectedVersions: '<4.0.10',
        fixedIn: '4.0.10',
        cweId: 'CWE-1333',
        cvssScore: 7.5,
        published: '2022-01-14',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2022-21681',
          'https://github.com/markedjs/marked/security/advisories/GHSA-5v2h-r2cx-5xgj'
        ]
      },
      {
        id: 'CVE-2022-21680',
        severity: 'high',
        title: 'Cross-Site Scripting (XSS) in marked',
        description: 'marked allows XSS through specially crafted markdown that bypasses sanitization.',
        affectedVersions: '<4.0.10',
        fixedIn: '4.0.10',
        cweId: 'CWE-79',
        cvssScore: 7.5,
        published: '2022-01-14',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2022-21680',
          'https://github.com/markedjs/marked/security/advisories/GHSA-rrrm-qjm4-v8hf'
        ]
      }
    ]
  },

  // Express - Web framework (server-side)
  {
    libraryName: 'express',
    cves: [
      {
        id: 'CVE-2022-24999',
        severity: 'high',
        title: 'Open Redirect in express',
        description: 'Express res.redirect() is vulnerable to open redirect attacks when redirecting to user-controlled URLs without validation.',
        affectedVersions: '<4.17.3',
        fixedIn: '4.17.3',
        cweId: 'CWE-601',
        cvssScore: 6.1,
        published: '2022-02-16',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2022-24999',
          'https://github.com/expressjs/express/security/advisories/GHSA-hrpp-h998-j3pp'
        ]
      }
    ]
  },

  // Socket.io - Real-time communication
  {
    libraryName: 'socket.io',
    cves: [
      {
        id: 'CVE-2022-2421',
        severity: 'critical',
        title: 'Uncaught Exception in socket.io',
        description: 'socket.io-parser allows attackers to cause uncaught exceptions leading to denial of service through crafted packets.',
        affectedVersions: '>=2.4.0 <4.0.5',
        fixedIn: '4.0.5',
        cweId: 'CWE-754',
        cvssScore: 7.5,
        published: '2022-11-22',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2022-2421',
          'https://github.com/socketio/socket.io/security/advisories/GHSA-qm95-pgcg-qqfq'
        ]
      }
    ]
  },

  // D3.js - Data visualization
  {
    libraryName: 'd3',
    cves: [
      {
        id: 'CVE-2021-23450',
        severity: 'medium',
        title: 'Prototype Pollution in d3-color',
        description: 'd3-color package is vulnerable to prototype pollution through the color parsing function.',
        affectedVersions: '<3.0.0',
        fixedIn: '3.0.0',
        cweId: 'CWE-1321',
        cvssScore: 5.6,
        published: '2021-11-02',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2021-23450',
          'https://snyk.io/vuln/SNYK-JS-D3COLOR-1579830'
        ]
      }
    ]
  },

  // Chart.js - Charting library
  {
    libraryName: 'chart.js',
    cves: [
      {
        id: 'CVE-2020-7746',
        severity: 'medium',
        title: 'Cross-Site Scripting (XSS) in Chart.js',
        description: 'Chart.js before 2.9.4 allows XSS through user-controlled chart options without proper sanitization.',
        affectedVersions: '<2.9.4',
        fixedIn: '2.9.4',
        cweId: 'CWE-79',
        cvssScore: 6.1,
        published: '2020-10-29',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2020-7746',
          'https://github.com/chartjs/Chart.js/security/advisories/GHSA-6c7p-m8xw-vw29'
        ]
      }
    ]
  },

  // Request - HTTP client (deprecated but still used)
  {
    libraryName: 'request',
    cves: [
      {
        id: 'CVE-2023-28155',
        severity: 'medium',
        title: 'Server-Side Request Forgery (SSRF) in request',
        description: 'request module follows HTTP redirects without validation, allowing SSRF attacks to internal services.',
        affectedVersions: '<=2.88.2',
        fixedIn: 'None (deprecated - migrate to axios or node-fetch)',
        cweId: 'CWE-918',
        cvssScore: 6.1,
        published: '2023-03-16',
        references: [
          'https://nvd.nist.gov/vuln/detail/CVE-2023-28155',
          'https://github.com/request/request/issues/3442'
        ]
      }
    ]
  }
]

/**
 * Check if a version matches the affected version pattern
 *
 * Supports:
 * - "<3.5.0" - less than 3.5.0
 * - ">=1.0.0 <2.3.4" - range
 * - "1.2.3" - exact version
 * - "<=2.88.2" - less than or equal
 *
 * Note: This is a simplified version comparison.
 * For production use, consider using semver library for robust version comparison.
 */
export function isVersionAffected(version: string, affectedVersionPattern: string): boolean {
  // Remove leading 'v' if present
  const cleanVersion = version.replace(/^v/, '')

  // Parse version into numbers
  const parseVersion = (v: string): number[] => {
    return v.split('.').map(n => parseInt(n) || 0)
  }

  // Compare two versions: -1 if v1 < v2, 0 if equal, 1 if v1 > v2
  const compareVersions = (v1: string, v2: string): number => {
    const parts1 = parseVersion(v1)
    const parts2 = parseVersion(v2)
    const maxLength = Math.max(parts1.length, parts2.length)

    for (let i = 0; i < maxLength; i++) {
      const num1 = parts1[i] || 0
      const num2 = parts2[i] || 0
      if (num1 < num2) return -1
      if (num1 > num2) return 1
    }
    return 0
  }

  // Handle range patterns like ">=1.0.0 <2.3.4"
  if (affectedVersionPattern.includes(' ')) {
    const conditions = affectedVersionPattern.split(' ')
    for (let i = 0; i < conditions.length; i += 2) {
      const operator = conditions[i].match(/^[<>=]+/)?.[0] || ''
      const targetVersion = conditions[i].replace(/^[<>=]+/, '') || conditions[i + 1]

      if (!targetVersion) continue

      const cmp = compareVersions(cleanVersion, targetVersion)

      if (operator === '<' && cmp >= 0) return false
      if (operator === '<=' && cmp > 0) return false
      if (operator === '>' && cmp <= 0) return false
      if (operator === '>=' && cmp < 0) return false
      if (operator === '=' && cmp !== 0) return false
    }
    return true
  }

  // Handle single condition like "<3.5.0" or ">=1.0.0"
  const match = affectedVersionPattern.match(/^([<>=]+)(.+)/)
  if (match) {
    const operator = match[1]
    const targetVersion = match[2]
    const cmp = compareVersions(cleanVersion, targetVersion)

    if (operator === '<') return cmp < 0
    if (operator === '<=') return cmp <= 0
    if (operator === '>') return cmp > 0
    if (operator === '>=') return cmp >= 0
    if (operator === '=') return cmp === 0
  }

  // Exact version match
  return compareVersions(cleanVersion, affectedVersionPattern) === 0
}

/**
 * Find all CVEs for a specific library and version
 */
export function findCVEsForLibrary(libraryName: string, version: string): CVE[] {
  const normalizedName = libraryName.toLowerCase().replace(/\.js$/, '')
  const libraryData = CVE_DATABASE.find(lib => lib.libraryName === normalizedName)

  if (!libraryData) return []

  return libraryData.cves.filter(cve => isVersionAffected(version, cve.affectedVersions))
}

/**
 * Get statistics about the CVE database
 */
export function getCVEDatabaseStats() {
  const totalLibraries = CVE_DATABASE.length
  const totalCVEs = CVE_DATABASE.reduce((sum, lib) => sum + lib.cves.length, 0)
  const criticalCVEs = CVE_DATABASE.reduce((sum, lib) =>
    sum + lib.cves.filter(cve => cve.severity === 'critical').length, 0
  )
  const highCVEs = CVE_DATABASE.reduce((sum, lib) =>
    sum + lib.cves.filter(cve => cve.severity === 'high').length, 0
  )

  return {
    totalLibraries,
    totalCVEs,
    criticalCVEs,
    highCVEs,
    libraries: CVE_DATABASE.map(lib => lib.libraryName)
  }
}
